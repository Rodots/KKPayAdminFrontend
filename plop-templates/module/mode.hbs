<script setup lang="ts">
import type { Props } from '../DetailForm/index.vue'
import DetailForm from '../DetailForm/index.vue'

const props = defineProps<{
  mode: 'dialog' | 'drawer'
} & Props>()

const emits = defineEmits<{
  success: []
}>()

const visible = defineModel<boolean>({
  default: false,
})

const formRef = useTemplateRef('formRef')

const title = computed(() => props.id ? '编辑{{ cname }}' : '新增{{ cname }}')

function onSubmit() {
  // submit() 为组件内部方法
  formRef.value?.submit().then(() => {
    emits('success')
    onCancel()
  })
}

function onCancel() {
  visible.value = false
}
</script>

<template>
  <div>
    <FaModal v-if="mode === 'dialog'" v-model="visible" :title destroy-on-close :close-on-click-overlay="false" :close-on-press-escape="false">
      <DetailForm ref="formRef" v-bind="$props" />
      <template #footer>
        <FaButton variant="outline" @click="onCancel">
          取消
        </FaButton>
        <FaButton @click="onSubmit">
          确定
        </FaButton>
      </template>
    </FaModal>
    <FaDrawer v-else-if="mode === 'drawer'" v-model="visible" :title destroy-on-close :close-on-click-overlay="false" :close-on-press-escape="false">
      <DetailForm ref="formRef" v-bind="$props" />
      <template #footer>
        <FaButton variant="outline" @click="onCancel">
          取消
        </FaButton>
        <FaButton @click="onSubmit">
          确定
        </FaButton>
      </template>
    </FaDrawer>
  </div>
</template>
